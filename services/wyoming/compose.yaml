services:
  wyoming-openwakeword:
    image: rhasspy/wyoming-openwakeword
    container_name: wyoming-openwakeword
    hostname: wyoming-openwakeword
    command: --preload-model ok_nabu
    healthcheck:
      test: ["CMD-SHELL", "python3 -c 'import socket; s=socket.create_connection((\"localhost\", 10400)); s.close()' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    labels:
      homepage.group: AI & Voice
      homepage.name: Wyoming OpenWakeWord
      homepage.icon: home-assistant
      homepage.description: Wake Word Detection
      traefik.enable: "false"
    ports:
      - 10400:10400
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    tmpfs:
      - /tmp:rw,noexec,nosuid,size=32m
    volumes:
      - ${DATA_PATH}/wyoming-openwakeword:/data
    networks:
      - nexus

  wyoming-piper:
    image: rhasspy/wyoming-piper
    container_name: wyoming-piper
    hostname: wyoming-piper
    command: --voice en_US-lessac-medium
    healthcheck:
      test: ["CMD-SHELL", "python3 -c 'import socket; s=socket.create_connection((\"localhost\", 10200)); s.close()' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    labels:
      homepage.group: AI & Voice
      homepage.name: Wyoming Piper
      homepage.icon: home-assistant
      homepage.description: Text-to-Speech
      traefik.enable: "false"
    ports:
      - 10200:10200
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 256M
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    tmpfs:
      - /tmp:rw,noexec,nosuid,size=64m
    volumes:
      - ${DATA_PATH}/wyoming-piper:/data
    networks:
      - nexus

  wyoming-whisper:
    image: rhasspy/wyoming-whisper
    container_name: wyoming-whisper
    hostname: wyoming-whisper
    command: --model small-int8 --language en
    healthcheck:
      test: ["CMD-SHELL", "python3 -c 'import socket; s=socket.create_connection((\"localhost\", 10300)); s.close()' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 120s
    labels:
      homepage.group: AI & Voice
      homepage.name: Wyoming Whisper
      homepage.icon: home-assistant
      homepage.description: Speech-to-Text
      traefik.enable: "false"
    ports:
      - 10300:10300
    deploy:
      resources:
        limits:
          cpus: '4.0'
          memory: 4G
        reservations:
          cpus: '1.0'
          memory: 1G
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    tmpfs:
      - /tmp:rw,noexec,nosuid,size=128m
    volumes:
      - ${DATA_PATH}/wyoming-whisper:/data
    networks:
      - nexus

networks:
  nexus:
    external: true
